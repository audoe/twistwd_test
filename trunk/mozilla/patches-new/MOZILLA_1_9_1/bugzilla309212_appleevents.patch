Index: toolkit/xre/nsCommandLineServiceMac.cpp
===================================================================
RCS file: /cvsroot/mozilla/toolkit/xre/nsCommandLineServiceMac.cpp,v
retrieving revision 1.5
diff -u -r1.5 toolkit/xre/nsCommandLineServiceMac.cpp
--- toolkit/xre/nsCommandLineServiceMac.cpp	3 Feb 2006 14:18:30 -0000	1.5
+++ toolkit/xre/nsCommandLineServiceMac.cpp	31 Mar 2006 22:43:40 -0000
@@ -48,6 +48,7 @@
 #include "nsNetUtil.h"
 #include "nsIAppStartup.h"
 #include "nsIServiceManager.h"
+#include "nsIObserverService.h"
 #include "nsIURL.h"
 #include "nsIIOService.h"
 #include "nsIURL.h"
@@ -85,7 +86,7 @@
 static PRInt32 ReadLine(FILE* inStream, char* buf, PRInt32 bufSize)
 {
   PRInt32 charsRead = 0;
-  int c;
+  int c = EOF;
   
   if (bufSize < 2)
     return -1;
@@ -289,6 +290,13 @@
 
 OSErr nsMacCommandLine::OpenURL(const char* aURL)
 {
+#if 1 // XXX Komodo patch to get apple events handle events in javascript
+  nsCOMPtr<nsIObserverService> observerService = do_GetService("@mozilla.org/observer-service;1");
+  if (observerService) {
+    observerService->NotifyObservers(nsnull, "open-url", NS_ConvertASCIItoUTF16(aURL).get());
+  }
+  return noErr;
+#else
   nsresult rv;
   
   nsCOMPtr<nsIPrefBranch> prefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID, &rv));
@@ -307,6 +315,7 @@
     return errAEEventNotHandled;
     
   return noErr;
+#endif
 }
 
 
