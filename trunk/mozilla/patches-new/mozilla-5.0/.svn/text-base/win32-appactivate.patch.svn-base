# HG changeset patch
# Parent 1c9cd44cff88310a3303844476a9adea88c52fd8
importing patch win32-appactivate.patch

diff --git a/widget/src/windows/nsWindow.cpp b/widget/src/windows/nsWindow.cpp
--- a/widget/src/windows/nsWindow.cpp
+++ b/widget/src/windows/nsWindow.cpp
@@ -161,6 +161,9 @@
 #include "nsWindowsDllInterceptor.h"
 #include "nsIWindowMediator.h"
 #include "nsIServiceManager.h"
+#include "nsCOMPtr.h"
+#include "nsXPCOM.h"
+#include "nsServiceManagerUtils.h"
 
 #if defined(WINCE)
 #include "nsWindowCE.h"
@@ -5554,6 +5557,29 @@ PRBool nsWindow::ProcessMessage(UINT msg
     break;
 #endif
 
+    case WM_ACTIVATEAPP:
+      {
+        if (mWindowType == eWindowType_toplevel) {
+            result = TRUE;
+            *aRetValue = result;
+            nsCOMPtr<nsISupportsPRBool> focusing =
+              do_CreateInstance(NS_SUPPORTS_PRBOOL_CONTRACTID);
+            focusing->SetData(wParam);
+     
+            nsCOMPtr<nsIObserverService> obsServ =
+              do_GetService("@mozilla.org/observer-service;1");
+     
+            if (obsServ)
+              obsServ->NotifyObservers(focusing, "application-activated", nsnull);
+        } else {
+            result = FALSE;
+            *aRetValue = result;
+        }
+      }
+      break;
+
+
+
   case WM_MOUSEWHEEL:
   case WM_MOUSEHWHEEL:
     {
